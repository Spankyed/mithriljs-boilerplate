// Declaring global variables
(function (window) {

  var document = window.document,
      app = {};

  app.container = document.getElementById('main');

  app.modules = {};

  app.module = function (name, instance, route) {
    if (!instance)
      return app.modules[name].instance;
    else
      app.modules[name] = { route : (route ? route : '/'), instance : instance };
  };

  app.defaultRoute = '/';

  window.app = app;

})(window);
(function (m, app) {

  // Creating the module
  app.module('TestModule', {});

})(m, app);
(function (m, app) {

  // Creating the module
  app.module('TestModule2', {}, '/test');

})(m, app);
(function (m, app) {

  // Controller
  app.module('TestModule').controller = function () {
    this.test = m.prop('<span style="color: red;">Hello World</span>');
  };

})(m, app);
(function (m, app) {

  // Controller
  app.module('TestModule2').controller = function () {
    var self = this;

    this.quote = m.prop({});
    this.quotes = m.prop([{
      text : '“Train yourself to let go of everything you fear to lose.”',
      author : 'Yoda'
    },
    {
      text : '“Death is a natural part of life. Rejoice for those around you who transform into the Force. Mourn them do not. Miss them do not.' +
              ' Attachment leads to jealously. The shadow of greed, that is.”',
      author : 'Yoda'
    },
    {
      text : '“The more you like yourself, the less you are like anyone else, which makes you unique.”',
      author : 'Walt Disney'
    },
    {
      text : '“The only true wisdom is in knowing you know nothing.”',
      author : 'Socrates'
    },
    {
      text : '“When it is obvious that the goals cannot be reached, don\'t adjust the goals, adjust the action steps.”',
      author : 'Confucius'
    }]);

    this.randomQuote = function () {
      self.quote(self.quotes()[Math.floor(Math.random() * self.quotes().length)]);
    };

    this.randomQuote();
  };

})(m, app);
(function (m, app) {

  // View
  app.module('TestModule').view = function (controller) {
    return m('div', [
        m('h2', controller.test()),
        m('h2.unfiltered', m.trust(controller.test())),
        m('input[type="text"]', {
                                  placeholder : 'Change the H2 text (the second h2 is unfiltered and allows HTML)...',
                                  onkeyup : function () {
                                              controller.test(this.value);
                                            }
                                })
      ]);
  };

})(m, app);
(function (m, app) {

  // View
  app.module('TestModule2').view = function (controller) {
    return m('div', [
        m('h2', controller.quote().text),
        m('p', [
          m('small', '- ' + controller.quote().author)
        ]),
        m('button', {
                      onclick : function (e) {
                                  e.preventDefault();
                                  controller.randomQuote();
                                }
        }, 'Random quote')
      ]);
  };

})(m, app);
(function (m, app) {

  // URL handling method
  m.route.mode = 'hash'; // needs .htaccess changes to use 'pathname'

  // Building routes
  var routes = {};

  for (var module in app.modules)
    routes[app.modules[module].route] = app.modules[module].instance;

  // Initialization
  m.route(app.container, app.defaultRoute, routes);

})(m, app);